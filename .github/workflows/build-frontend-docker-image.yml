name: Build Frontend Docker Image

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install and Build
        run: |
          cd ./frontend
          npm install
          npm run dev &              # üîπ ‡∏£‡∏±‡∏ô dev server ‡πÅ‡∏ö‡∏ö background
          sleep 10                   # üîπ ‡∏£‡∏≠ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÉ‡∏´‡πâ server ‡πÄ‡∏£‡∏¥‡πà‡∏°
          curl -I http://localhost:5173 || true  # üîπ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ server ‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°
          pkill -f "vite"            # üîπ ‡∏´‡∏¢‡∏∏‡∏î process dev server
          npm run build  => ‡∏ñ‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞ run build ‡πÑ‡∏î‡πâ

      - name: Build Docker image
        run: |
          docker build -t hello-devops-frontend:latest ./frontend

      # (Optional) Push image ‡πÑ‡∏õ Docker Hub
      # - name: Push image to Docker Hub
      #   if: success()
      #   run: |
      #     echo "${{ secrets.DOCKER_HUB_TOKEN }}" | docker login -u "${{ secrets.DOCKER_HUB_USERNAME }}" --password-stdin
      #     docker tag hello-devops-frontend:latest ${{ secrets.DOCKER_HUB_USERNAME }}/hello-devops-frontend:latest
      #     docker push ${{ secrets.DOCKER_HUB_USERNAME }}/hello-devops-frontend:latest

